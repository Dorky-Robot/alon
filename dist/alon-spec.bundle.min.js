!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";const e="__AlonEvent__";function n(n,t){n.dispatchEvent(new CustomEvent(e,{detail:{...t,__alonSignalUp__:!0},bubbles:!0,cancelable:!0,composed:!0}))}function t(e,n){e.stopPropagation();for(const[t,o]of n.entries()){const n=t(e.detail);void 0!==n&&o.forEach((t=>t(n,e)))}}function o(n,o,l){n.alonBubblingHandlers||(n.alonBubblingHandlers=new Map,n.addEventListener(e,(e=>{e.detail.__alonSignalDown__||t(e,n.alonBubblingHandlers)})));const a=n.alonBubblingHandlers.get(o)||[];a.push(l),n.alonBubblingHandlers.set(o,a)}describe("bubbling",(()=>{const l=Habiscript.toElement,a=l(["span",{id:"name"}]),s=l(["div",{id:"person"},a]);it("catches bubbling events from signalUp event and should be seen in the capture",(()=>{let l;document.body.appendChild(s),o(s,(e=>e.person.name),(e=>l=e));let r=0;!function(n,o,l){n.alonCaptureHandlers||(n.alonCaptureHandlers=new Map,n.addEventListener(e,(e=>{e.detail.__alonSignalUp__||t(e,n.alonCaptureHandlers)}),!0));const a=n.alonCaptureHandlers.get(o)||[];a.push(l),n.alonCaptureHandlers.set(o,a)}(s,(e=>e.person.name),(e=>r++)),n(a,{person:{name:"Felix"}}),expect(l).toEqual("Felix"),expect(r).toEqual(0)})),it("calls multiple handlers for different resolvers",(()=>{let e,t;document.body.appendChild(s),o(s,(e=>e.person.firstName),(n=>{e=n})),o(s,(e=>e.person.lastName),(e=>{t=e})),n(a,{person:{firstName:"Felix",lastName:"Flores"}}),expect(e).toEqual("Felix"),expect(t).toEqual("Flores")})),it("does not call handlers when the resolver returns undefined",(()=>{document.body.appendChild(s);let e=!1;o(s,(e=>{}),(n=>{e=!0})),n(a,{person:{name:"Felix"}}),expect(e).toBe(!1)})),it("does call handlers when the resolver returns false",(()=>{document.body.appendChild(s);let e=!1;o(s,(e=>!1),(n=>{e=!0})),n(a,{person:{name:"Felix"}}),expect(e).toBe(!0)})),it("calls the same resolver only once but multiple handlers for that resolver",(()=>{document.body.appendChild(s);let e=0;const t=n=>(e++,n.person.name);let l,r;o(s,t,(e=>{l=e})),o(s,t,(e=>{r=e})),n(a,{person:{name:"Felix Flores"}}),expect(e).toEqual(1),expect(l).toEqual("Felix Flores"),expect(r).toEqual("Felix Flores")})),it("does not propagate the event to the outer element if the capture resolves",(()=>{const e=l(["span",{id:"name"}]),t=l(["div",{id:"person"},e]),a=l(["div",t]);document.body.appendChild(a);let s=!1,r=!1;o(t,(e=>e.person.name),((e,n)=>{s=!0})),o(a,(e=>e.person.name),((e,n)=>{r=!0})),n(e,{person:{name:"Felix Flores"}}),expect(s).toBe(!0),expect(r).toBe(!1)})),it("does not propagate the event to the outer element if the resolver does not resolves",(()=>{const e=l(["span",{id:"name"}]),t=l(["div",{id:"person"},e]),a=l(["div",t]);document.body.appendChild(a);let s=!1;o(t,(e=>e.person.random),((e,n)=>{s=!0}));let r=!1;o(a,(e=>e.person.name),((e,n)=>{console.log("outer",n,e),r=!0})),n(e,{person:{name:"Felix Flores"}}),expect(s).toBe(!1),expect(r).toBe(!1)}))}))}));
